
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Trace of Learning Process">
    <title>Archives - Trace of Learning Process</title>
    <meta name="author" content="Sho Mizoe">
    
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <meta property="og:type" content="blog">
<meta property="og:title" content="Trace of Learning Process">
<meta property="og:url" content="http://learning.ptrac.es/archives/index.html">
<meta property="og:site_name" content="Trace of Learning Process">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Trace of Learning Process">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-ejlztp1tasruqfvoz6xmgqng0anzae8ox7cqjj5yibieqgcmhe9fwxfae6zj.min.css">
    <!--STYLES END-->
    
    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">Trace of Learning Process</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="2">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/smizoe" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">github account</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/atom.xml"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    

<section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2018/02/10/How-to-Integrate-Pipenv-into-Emacs/">
                            How to Integrate Pipenv into Emacs
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Sat Feb 10 2018 13:50:55 GMT-0800">
	
		    Feb 10, 2018
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>In the past, I mainly used <a href="https://virtualenv.pypa.io/en/stable/" target="_blank" rel="external">virtualenv</a> and <a href="https://docs.python.org/3/library/venv.html" target="_blank" rel="external">venv</a> to manage packages for each project, but recently a new package management tool for python has been becoming popular. The new package management tool, <a href="https://github.com/pypa/pipenv" target="_blank" rel="external">Pipenv</a>, is now recommended in the official python page.</p>
<p>I have been working on switching from older tools to pipenv, but there have been one obstacle against it; the lack of emacs-pipenv integration (there is <a href="https://github.com/pwalsh/pipenv.el" target="_blank" rel="external">pipenv.el</a> today, so you might want to use it rather than writing your own.)<br>After digging into this issue, it turned out it’s fairly easy to integrate these two.</p>
<p>In this post, I will present one way to integrate pipenv with emacs with tens of lines of emacs lisp, by means of <a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Advising-Functions.html." target="_blank" rel="external">advice feature</a></p>
<h2 id="Purpose"><a href="#Purpose" class="headerlink" title="Purpose"></a>Purpose</h2><p>I set the following purpose for emacs-pipenv integration:</p>
<ol>
<li>activation of a virtual environment associated with the file of a buffer before running a (elisp) function that uses python internally. e.g., we want to enable a virtual environment when we call run-python function.</li>
<li>calling the function with the virtual environment active</li>
<li>deactivation of the virtual environment after the function finishes</li>
</ol>
<p>Since my main entry point for python is run-python function, I focus on an advice function for this function.</p>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>Since <code>pipenv --venv</code> returns a virtual environment for the current directory (assuming there is a Pipfile in it or one of its ancestor directory), we can easily make an advice function:</p>
<script src="//gist.github.com/5b1751c8ca15182be7f49c19f547ab0c.js"></script>
<p><code>advice-pipenv-venv</code> is the most important function and can be used as:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(advice-add #&apos;run-python :around #&apos;advice-pipenv-venv)</div></pre></td></tr></table></figure>
<p>Now we don’t need to think about which virtualenv we should activate, since the right one is automatically selected!</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2018/02/10/How-to-Integrate-Pipenv-into-Emacs/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/11/04/How-to-Insert-into-a-non-Public-Schema-in-Postgres-with-Odo/">
                            How to Insert into a non-Public Schema in Postgres with Odo
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Sat Nov 04 2017 21:28:14 GMT-0700">
	
		    Nov 04, 2017
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p><a href="http://odo.pydata.org/en/latest/" target="_blank" rel="external">Odo</a>(<a href="https://github.com/blaze/odo" target="_blank" rel="external">the github repository of Odo</a>) is a great tool for moving data from one place/format to another. But when I tried to transfer data in the csv format into a table in a non-public schema in a PostgreSQL database, it took some time to find out how to do it with odo.</p>
<p>At first I could not load data even to a table in the public schema since it uses <code>COPY :tbl FROM :path</code> (see <a href="https://github.com/blaze/odo/blob/0.5.0/odo/backends/sql_csv.py#L157" target="_blank" rel="external">this line</a>).<br>Fortunately loading csv files into PostgreSQL is available on master branch or v0.5.1 branch, so it’s resolved by specifying these branches at installation.</p>
<p>Another problem was it’s unclear how to specify the name of the schema. When I looked at <a href="https://github.com/blaze/odo/blob/0.5.1/bin/odo" target="_blank" rel="external">the source code of odo CLI</a>, it turned out it’s very straight-forward with it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ odo path/to/data.csv postgres://user:pass@host/dbname::table_name --schema schema_name</div></pre></td></tr></table></figure>
<p>As you can see from the source, you can specify any keyword arguments that are accepted by <code>odo</code> function.</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/11/04/How-to-Insert-into-a-non-Public-Schema-in-Postgres-with-Odo/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2017/10/16/Let-s-Test-SQL-Queries-Using-Datalog/">
                            Let&#39;s Test SQL Queries Using Datalog
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Mon Oct 16 2017 23:24:49 GMT-0700">
	
		    Oct 16, 2017
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>I’m not sure if this is a common practice, but I prefer testing my SQL queries.<br>As far as I know, there are at least 3 ways to test SQL queries:</p>
<ol>
<li>checking if the query runs on the real data (a.k.a. no testing)</li>
<li>providing input data and the expected result (that is calculated manually) and comparing the actual result with the expected one</li>
<li>after writing an equivalent query in a non-SQL language (in, e.g., Active Record or datalog), checking outputs from the SQL query and the new query by issuing them onto certain input data</li>
</ol>
<p>In the past I adopted option 2 mainly. Although we can accumulate test cases by adopting option 2, this way of testing is tedious and incomplete because:</p>
<ul>
<li>we have to calculate the output by hand; This is error-prone and time-consuming. (although we may write code for calculating the output, it would require testing for itself…)</li>
<li>if we change our queries in future, we need to recalculate everything manually</li>
<li>we cannot test on unknown failure cases; i.e., we cannot use randomly generated cases</li>
</ul>
<p>If we ask ‘can we solve these by using option 3?’, the answer is yes since:</p>
<ul>
<li>we can generate both outputs (from SQL and some other language) programmatically, rather than manually</li>
<li>we can adapt to the new case by changing the existing test code, which does not require much calculation by hand</li>
<li>since both SQL and the language used for testing can process a lot of data (at least much more than human beings can), we can apply randomized testing.</li>
</ul>
<p>In the following, I’ll show you how we can test SQL using <a href="https://sites.google.com/site/pydatalog/home" target="_blank" rel="external">pyDatalog</a>, a logic programming library in Python.</p>
<h1 id="Installation-of-Packages"><a href="#Installation-of-Packages" class="headerlink" title="Installation of Packages"></a>Installation of Packages</h1><p>Let’s start by installing required packages with <a href="https://packaging.python.org/new-tutoriAls/installing-and-using-packages/#installing-pipenv" target="_blank" rel="external">pipenv</a>.<br>To do so, all we need to do is create an empty directory and put <code>Pipfile</code> with the following content:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[[source]]</div><div class="line"></div><div class="line">url = &quot;https://pypi.python.org/simple&quot;</div><div class="line">verify_ssl = true</div><div class="line">name = &quot;pypi&quot;</div><div class="line"></div><div class="line"></div><div class="line">[packages]</div><div class="line"></div><div class="line">pydatalog = &quot;*&quot;</div><div class="line">ipython = &quot;*&quot;</div><div class="line">sqlalchemy = &quot;*&quot;</div><div class="line">pandas = &quot;*&quot;</div><div class="line"></div><div class="line"></div><div class="line">[dev-packages]</div></pre></td></tr></table></figure>
<p>Then inside the directory, let’s run the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ pipenv install</div></pre></td></tr></table></figure>
<p>This should install 4 packages (<code>pyDatalog</code>, <code>pandas</code>, <code>ipython</code> and <code>sqlalchemy</code>)and their dependencies.<br>(In a real environment, you may want to list these in <code>dev-packages</code> section.)</p>
<h1 id="Testing-Queries-with-pyDatalog"><a href="#Testing-Queries-with-pyDatalog" class="headerlink" title="Testing Queries with pyDatalog"></a>Testing Queries with pyDatalog</h1><p>In this example, we use sqlite and consider 2 tables generated by the following DDL:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tbl1(</div><div class="line">  <span class="keyword">id</span> <span class="built_in">integer</span> PRIMARY <span class="keyword">KEY</span>,</div><div class="line">  col1 <span class="built_in">text</span>,</div><div class="line">  created_date <span class="built_in">text</span>  <span class="comment">-- use text since datetime/date does not work well with sqlalchemy</span></div><div class="line">);</div></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tbl2(</div><div class="line">  <span class="keyword">id</span> <span class="built_in">integer</span> PRIMARY <span class="keyword">KEY</span>,</div><div class="line">  tbl1_id <span class="built_in">integer</span>,</div><div class="line">  col2 <span class="built_in">text</span></div><div class="line">);</div></pre></td></tr></table></figure>
<p>Here <code>tbl1_id</code> column in <code>tbl2</code> associates a record in <code>tbl2</code> with one or more records in <code>tbl1</code>.</p>
<p>Let’s create these tables and corresponding datalog terms:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine</div><div class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</div><div class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</div><div class="line"></div><div class="line"><span class="keyword">from</span> pyDatalog <span class="keyword">import</span> pyDatalog</div><div class="line"></div><div class="line">engine = create_engine(<span class="string">'sqlite://'</span>)</div><div class="line"></div><div class="line">engine.execute(<span class="string">"""</span></div><div class="line">CREATE TABLE tbl1(</div><div class="line">  id integer PRIMARY KEY,</div><div class="line">  col1 text,</div><div class="line">  created_date text</div><div class="line">);</div><div class="line">""")</div><div class="line">engine.execute(<span class="string">"""</span></div><div class="line">INSERT INTO tbl1(col1, created_date)</div><div class="line">VALUES ('foo', '2017-10-11'), ('bar', '2017-10-12');</div><div class="line">""")</div><div class="line"></div><div class="line">engine.execute(<span class="string">"""</span></div><div class="line">CREATE TABLE tbl2(</div><div class="line">  id integer PRIMARY KEY,</div><div class="line">  tbl1_id integer,</div><div class="line">  col2 text</div><div class="line">);</div><div class="line">""")</div><div class="line">engine.execute(<span class="string">"""</span></div><div class="line">INSERT INTO tbl2(tbl1_id, col2)</div><div class="line">VALUES (1, 2), (3, 3);</div><div class="line">""")</div><div class="line"></div><div class="line"></div><div class="line">Base = declarative_base(bind=engine, cls=pyDatalog.Mixin, metaclass=pyDatalog.sqlMetaMixin)</div><div class="line">Session = sessionmaker(bind=engine)</div><div class="line">session = Session()</div><div class="line">Base.session = session</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tbl1</span><span class="params">(Base)</span>:</span></div><div class="line">    __tablename__ = <span class="string">'tbl1'</span></div><div class="line">    __table_args__ = &#123;<span class="string">'autoload'</span>:<span class="keyword">True</span>&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tbl2</span><span class="params">(Base)</span>:</span></div><div class="line">    __tablename__ = <span class="string">'tbl2'</span></div><div class="line">    __table_args__ = &#123;<span class="string">'autoload'</span>:<span class="keyword">True</span>&#125;</div></pre></td></tr></table></figure>
<h2 id="Case-1-Parameterized-Query"><a href="#Case-1-Parameterized-Query" class="headerlink" title="Case 1: Parameterized Query"></a>Case 1: Parameterized Query</h2><p>When we write a batch job, we may want to parameterize a query so that we can specify the target date:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">  *</div><div class="line"><span class="keyword">FROM</span></div><div class="line">  tbl1</div><div class="line"><span class="keyword">WHERE</span></div><div class="line">  created_date = ?</div></pre></td></tr></table></figure>
<p>An equivalent query can be written in pyDatalog. We run the following as preparation for the actual query:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_df</span><span class="params">(answers)</span>:</span></div><div class="line">    <span class="string">"""make a pandas dataframe from pyDatalog.Answer.answers field,</span></div><div class="line">    which contains a list of tuples</div><div class="line">    """</div><div class="line">    <span class="keyword">return</span> pd.DataFrame([</div><div class="line">        dict(id=tup[<span class="number">0</span>].id,</div><div class="line">             col1=tup[<span class="number">0</span>].col1,</div><div class="line">             created_date=tup[<span class="number">0</span>].created_date) <span class="keyword">for</span> tup <span class="keyword">in</span> answers</div><div class="line">    ])</div><div class="line"></div><div class="line"><span class="meta">@pyDatalog.program()</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parameterized_query_example</span><span class="params">()</span>:</span></div><div class="line">    Tbl1.records_today(X, Today) &lt;= (Tbl1.created_date[X] == Today)</div></pre></td></tr></table></figure>
<p>If we want to query in pyDatalog, we use <code>pyDatalog.ask</code> method:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ans = pyDatalog.ask(<span class="string">'Tbl1.records_today(X, "&#123;dt&#125;")'</span>.format(dt=<span class="string">'2017-10-12'</span>)).answers</div><div class="line">by_datalog = get_df(ans)</div></pre></td></tr></table></figure>
<p>Since we get a result, let’s compare it with the result from the sql using <a href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.testing.assert_frame_equal.html" target="_blank" rel="external">assert_frame_equal</a> from pandas:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">from pandas.testing import assert_frame_equal</div><div class="line">sql = &quot;&quot;&quot;</div><div class="line">SELECT</div><div class="line">  *</div><div class="line">FROM</div><div class="line">  tbl1</div><div class="line">WHERE</div><div class="line">  created_date = ?</div><div class="line">&quot;&quot;&quot;</div><div class="line">by_sql = pd.read_sql(sql, engine, params=(&apos;2017-10-12&apos;,))</div><div class="line">assert_frame_equal(by_sql[sorted(by_sql.columns)], by_datalog[sorted(by_datalog.columns)])</div><div class="line"># =&gt; passes</div></pre></td></tr></table></figure>
<p>We successfully tested the SQL!</p>
<h2 id="Case-2-Join"><a href="#Case-2-Join" class="headerlink" title="Case 2: Join"></a>Case 2: Join</h2><p>Now let’s consider the following query:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span></div><div class="line">  tbl1.id <span class="keyword">AS</span> id1,</div><div class="line">  tbl2.id <span class="keyword">AS</span> id2</div><div class="line"><span class="keyword">FROM</span></div><div class="line">  tbl1</div><div class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span></div><div class="line">  tbl2</div><div class="line"><span class="keyword">ON</span></div><div class="line">  tbl1.id = tbl2.tbl1_id</div></pre></td></tr></table></figure>
<p>Since we have no record associated with the record with id 2, we need to keep this record in datalog.<br>We can achieve this in the following manner:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@pyDatalog.program()</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">left_join_example</span><span class="params">()</span>:</span></div><div class="line">    has_id1(Z, X) &lt;= (Tbl1.id[X] == Z)</div><div class="line">    has_id2(Z, Y) &lt;= (Tbl2.tbl1_id[Y] == Z)</div><div class="line">    left_join(Z, X, Y) &lt;= has_id1(Z, X) &amp; has_id2(Z, Y)</div><div class="line">    left_join(Z, X, <span class="keyword">None</span>) &lt;= has_id1(Z, X) &amp; ~has_id2(Z, Y)</div></pre></td></tr></table></figure>
<p>Let’s compare the results from datalog and SQL:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_lj_df</span><span class="params">(answers)</span>:</span></div><div class="line">    <span class="keyword">return</span> pd.DataFrame([</div><div class="line">        dict(id1=r1.id, id2=<span class="keyword">None</span> <span class="keyword">if</span> r2 <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">else</span> r2.id)</div><div class="line">        <span class="keyword">for</span> __, r1, r2 <span class="keyword">in</span> answers</div><div class="line">    ])</div><div class="line"></div><div class="line">by_datalog = get_lj_df(pyDatalog.ask(<span class="string">"left_join(Z, X, Y)"</span>).answers)</div><div class="line"></div><div class="line">sql2 = <span class="string">"""</span></div><div class="line">SELECT</div><div class="line">  tbl1.id AS id1,</div><div class="line">  tbl2.id AS id2</div><div class="line">FROM</div><div class="line">  tbl1</div><div class="line">LEFT OUTER JOIN</div><div class="line">  tbl2</div><div class="line">ON</div><div class="line">  tbl1.id = tbl2.tbl1_id</div><div class="line">"""</div><div class="line">by_sql = pd.read_sql(sql2, engine)</div><div class="line"></div><div class="line"><span class="comment">## prepare for comparison</span></div><div class="line">by_sql = (</div><div class="line">    by_sql[sorted(by_sql.columns)]</div><div class="line">    .sort_values([<span class="string">'id1'</span>, <span class="string">'id2'</span>])</div><div class="line">    .reset_index(drop=<span class="keyword">True</span>)</div><div class="line">)</div><div class="line">by_datalog = (</div><div class="line">    by_datalog[sorted(by_datalog.columns)]</div><div class="line">    .sort_values([<span class="string">'id1'</span>, <span class="string">'id2'</span>])</div><div class="line">    .reset_index(drop=<span class="keyword">True</span>)</div><div class="line">)</div><div class="line"></div><div class="line">assert_frame_equal(by_sql, by_datalog)</div><div class="line"><span class="comment"># =&gt; passes</span></div></pre></td></tr></table></figure>
<p>So we can test a query with joins, even if some of them are outer joins!</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>We can test SQL using datalog and it has the following strength, compared to testing by specifying a pair of input and output:</p>
<ul>
<li>it lets us avoid manual calculation</li>
<li>it lets us use randomized input instances</li>
</ul>

                    
                        

                    
                    
                        <p>
                            <a href="/2017/10/16/Let-s-Test-SQL-Queries-Using-Datalog/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/08/01/Managing-Multiple-Git-Configurations/">
                            Managing Multiple Git Configurations
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Mon Aug 01 2016 21:15:40 GMT-0700">
	
		    Aug 01, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>Since I have a personal laptop which is different from the laptop I use at work, I have a problem when I would like to make a commit to my personal repository. (e.g., when I add a new function to my dotfiles, I usually want to use it on my personal laptop.); I need to manage multiple git configurations so that I can commit with my personal user profile instead of my profile in the company (user name, email etc.)</p>
<p>To address this problem, I so far set the following script to git’s pre-commit hook together with a global git config with user.email and user.name set to ‘SET_ME_LOCALLY’:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#!/bin/sh</div><div class="line">if [ &quot;`git config user.name`&quot; == SET_ME_LOCALLY ]; then</div><div class="line">    echo &quot;fatal: user.name is not set locally&quot;</div><div class="line">    exit 1</div><div class="line">fi</div><div class="line">if [ &quot;`git config user.email`&quot; == SET_ME_LOCALLY ]; then</div><div class="line">    echo &quot;fatal: user.email is not set locally&quot;</div><div class="line">    exit 1</div><div class="line">fi</div></pre></td></tr></table></figure>
<p>Although this stops commit when either of user name or email address is not set, this has a problem: I have to type in my name and email address even when I’m on my personal laptop.<br>To avoid typing my profile every time I make a new repository, I now set the following script as my pre-commit hook:</p>
<figure class="highlight bash"><figcaption><span>pre-commit</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"><span class="built_in">set</span> -eu</div><div class="line"></div><div class="line"><span class="comment">## We read value of multiuser.config in global git config and find out a config file</span></div><div class="line"><span class="comment">## that we would like to merge with global config.</span></div><div class="line"><span class="comment">## We suport reading only one file since it should suffice for our use case</span></div><div class="line"></div><div class="line"><span class="comment">## currently we skip setup of config if .prev_config file exists in .git directory</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;GIT_DIR&#125;</span>"</span> = <span class="string">"<span class="variable">$(pwd)</span>"</span> ] ; <span class="keyword">then</span></div><div class="line"><span class="comment">## bare repository</span></div><div class="line"><span class="comment">## see https://git-scm.com/docs/githooks/2.9.2</span></div><div class="line">    GIT_CFG_PATH=<span class="string">"<span class="variable">$(pwd)</span>/config"</span></div><div class="line"><span class="keyword">else</span></div><div class="line">    GIT_CFG_PATH=<span class="string">"<span class="variable">$(pwd)</span>/.git/config"</span></div><div class="line"><span class="keyword">fi</span></div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">check_if_merged</span></span>()&#123;</div><div class="line">  <span class="comment">## 1st argument: path to the gitconfig (something like $&#123;worktree_root&#125;/.git/config)</span></div><div class="line"></div><div class="line">  <span class="built_in">set</span> +e</div><div class="line">  <span class="built_in">stat</span> <span class="string">"<span class="variable">$(dirname "$&#123;1&#125;")</span>/.prev_config"</span> &amp;&gt; /dev/null</div><div class="line">  <span class="keyword">if</span> [ <span class="string">"$?"</span> <span class="_">-eq</span> 0 ] ; <span class="keyword">then</span></div><div class="line">      <span class="built_in">echo</span> <span class="string">"We skip setting up config since we have .prev_config file"</span> &gt;&amp;2</div><div class="line">      <span class="built_in">exit</span> 0</div><div class="line">  <span class="keyword">fi</span></div><div class="line">  <span class="built_in">set</span> <span class="_">-e</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">get_additional_cfg</span></span>()&#123;</div><div class="line">    <span class="comment">## the following command fails if multiuser.confdir is not set</span></div><div class="line">    <span class="built_in">local</span> my_conf_dir=<span class="string">"<span class="variable">$(git config multiuser.confdir)</span>"</span></div><div class="line">    <span class="comment">## we need to expand ~; otherwise ls fails</span></div><div class="line">    <span class="built_in">local</span> my_conf_dir=<span class="string">"<span class="variable">$&#123;my_conf_dir/#\~/$&#123;HOME&#125;</span>&#125;"</span></div><div class="line"></div><div class="line">    <span class="built_in">echo</span> <span class="string">"Please input the prefix of the config file: "</span> &gt;&amp;2</div><div class="line">    <span class="built_in">exec</span> &lt; /dev/tty</div><div class="line">    <span class="built_in">read</span> conf_prefix</div><div class="line"></div><div class="line">    <span class="built_in">local</span> pattern=<span class="string">"<span class="variable">$&#123;my_conf_dir&#125;</span>/<span class="variable">$&#123;conf_prefix&#125;</span>*"</span></div><div class="line">    <span class="built_in">local</span> candidates=($(ls <span class="_">-d</span> <span class="variable">$&#123;pattern&#125;</span>))</div><div class="line"></div><div class="line">    <span class="built_in">local</span> num_matched_files=<span class="string">"<span class="variable">$&#123;#candidates[@]&#125;</span>"</span></div><div class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;num_matched_files&#125;</span>"</span> <span class="_">-ne</span> 1 ] ; <span class="keyword">then</span></div><div class="line">        <span class="keyword">if</span> [ <span class="string">"<span class="variable">$&#123;num_matched_files&#125;</span>"</span> <span class="_">-gt</span> 1 ] ; <span class="keyword">then</span></div><div class="line">            <span class="built_in">echo</span> <span class="string">"More than 1 file matched with pattern: <span class="variable">$&#123;pattern&#125;</span>"</span> &gt;&amp;2</div><div class="line">            <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"The matched files are:\n<span class="variable">$&#123;candidates[@]&#125;</span>\n"</span> &gt;&amp;2</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="built_in">echo</span> <span class="string">"no files mathched with pattern: <span class="variable">$&#123;pattern&#125;</span>"</span> &gt;&amp;2</div><div class="line">        <span class="keyword">fi</span></div><div class="line">        <span class="built_in">echo</span> <span class="_">-e</span> <span class="string">"The files in <span class="variable">$&#123;my_conf_dir&#125;</span> are:\n<span class="variable">$(echo $&#123;my_conf_dir&#125;/*)</span>\n"</span> &gt;&amp;2</div><div class="line">        <span class="built_in">echo</span> <span class="string">"aborted the commit."</span> &gt;&amp;2</div><div class="line">        <span class="built_in">exit</span> 2</div><div class="line">    <span class="keyword">fi</span></div><div class="line"></div><div class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$&#123;candidates[0]&#125;</span>"</span></div><div class="line">    <span class="built_in">return</span> 0</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">function</span> <span class="function"><span class="title">update_conf</span></span>()&#123;</div><div class="line">    <span class="comment">## 1st argument: default config (something like $&#123;worktree_dir&#125;/.git/config)</span></div><div class="line">    <span class="comment">## 2nd argument: additional config which override the default one</span></div><div class="line">    cp <span class="string">"<span class="variable">$&#123;1&#125;</span>"</span> <span class="string">"<span class="variable">$(dirname "$&#123;1&#125;")</span>/.prev_config"</span></div><div class="line">    DEFAULT_CFG=<span class="string">"<span class="variable">$&#123;1&#125;</span>"</span> ADDITIONAL_CFG=<span class="string">"<span class="variable">$&#123;2&#125;</span>"</span> python2 &lt;&lt;EOF</div><div class="line">from __future__ import <span class="built_in">print</span>_<span class="keyword">function</span></div><div class="line">from StringIO import StringIO</div><div class="line">from ConfigParser import ConfigParser</div><div class="line">import os</div><div class="line"></div><div class="line">cfg_file = os.environ[<span class="string">'DEFAULT_CFG'</span>]</div><div class="line">override_file = os.environ[<span class="string">'ADDITIONAL_CFG'</span>]</div><div class="line">parser = ConfigParser()</div><div class="line"></div><div class="line"><span class="keyword">for</span> filename <span class="keyword">in</span> [cfg_file, override_file]:</div><div class="line">  with open(filename, <span class="string">"r"</span>) as cfg_io:</div><div class="line">    ini = <span class="string">''</span>.join(map(lambda line: line.lstrip(), cfg_io.readlines()))</div><div class="line">    parser.readfp(StringIO(ini))</div><div class="line"></div><div class="line">with open(cfg_file, <span class="string">"w"</span>) as f:</div><div class="line">  <span class="keyword">for</span> section_name <span class="keyword">in</span> parser.sections():</div><div class="line">    f.write(<span class="string">"[&#123;&#125;]\n"</span>.format(section_name))</div><div class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> parser.items(section_name):</div><div class="line">      f.write(<span class="string">"\t&#123;&#125; = &#123;&#125;\n"</span>.format(k, v))</div><div class="line">EOF</div><div class="line">&#125;</div><div class="line"></div><div class="line">check_<span class="keyword">if</span>_merged <span class="string">"<span class="variable">$&#123;GIT_CFG_PATH&#125;</span>"</span></div><div class="line">additional_cfg=<span class="string">"<span class="variable">$(get_additional_cfg)</span>"</span></div><div class="line">update_conf <span class="string">"<span class="variable">$&#123;GIT_CFG_PATH&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;additional_cfg&#125;</span>"</span></div><div class="line"><span class="comment">## we need to reload config by exiting the current process</span></div><div class="line"><span class="built_in">echo</span> <span class="string">"update finished. Please retry the commit. (This commit will exit with 1)"</span> &gt;&amp;2</div><div class="line"><span class="built_in">exit</span> 1</div><div class="line"></div></pre></td></tr></table></figure>
<p>The code above does the following:</p>
<ol>
<li>checks if .git directory contains a file named .prev_config. If it did, this script exits with 0.</li>
<li>gets a list of git configuration files stored in a directory specified by value of multiuser.confdir in the global git config.</li>
<li>prompts the user to input (the prefix of) a git config to use.</li>
<li>merges the repository’s local config file with the specified file and puts it to .git/config. The previous config file is backed up as .git/.prev_confing.</li>
</ol>
<p>By using this, we can use different values for user names, email addresses and even for other configuration values.</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/08/01/Managing-Multiple-Git-Configurations/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/03/28/Hidden-Filter-in-Hadoop/">
                            Hidden Filter in Hadoop
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Mon Mar 28 2016 22:16:02 GMT-0700">
	
		    Mar 28, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>When I was testing a mapreduce job written in <a href="https://crunch.apache.org" target="_blank" rel="external">Apache Crunch</a>, I encountered a strange error. Although a file exists, the job won’t find the file; i.e., although it appears in the result of FileSystem#listStatus, an exception is thrown saying ‘Input path does not exist’ when I pass the file name to crunch’s Pipeline#readTextFile.</p>
<p>After about one hour of struggle, I finally found the cause: if a file name starts with _ (underscore), FileInputFormat silently skips the file. FileInputFormat has a private field named <a href="https://github.com/apache/hadoop/blob/release-2.7.1/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/lib/input/FileInputFormat.java#L90" target="_blank" rel="external">hidden_filter</a> and this is automatically applied when input paths of a job are read.</p>
<p>I hope this saves someone’s time…</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/03/28/Hidden-Filter-in-Hadoop/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/03/06/Passing-HBase-Configurations-from-Hive-Query/">
                            Passing HBase Configurations from Hive Query
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Sun Mar 06 2016 09:40:48 GMT-0800">
	
		    Mar 06, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-content" itemprop="articleBody">
                    <p>In the current company, we employ Hive and HBase for storing and processing data. Although HBase has a good java api to make queries to HBase, Hive’s <a href="https://cwiki.apache.org/confluence/display/Hive/HBaseIntegration" target="_blank" rel="external">HBase Integration</a> enables us to aggregate information in HBase with simplicity of SQL.</p>
<p>Since Hive converts the query to a mapreduce job, as noted in <a href="https://hbase.apache.org/book.html#perf.hbase.client.blockcache" target="_blank" rel="external">HBase’s Document</a>.<br>We also would like to set the number of prefetched rows by a scanner (via Scan#setCaching), since it would result in a poor performance if the value is too low.</p>
<p>I first found out <a href="http://stackoverflow.com/questions/30074734/tuning-hive-queries-that-uses-underlying-hbase-table" target="_blank" rel="external">a post on stackoverflow</a>, but several of the parameters sugggested seems not to be documented on Hive’s HBase Integration page. The only way to check what is available seems to search Hive source code on github…</p>
<p>As a result of search, I found 2 classes that gives the answer: <a href="https://github.com/apache/hive/blob/release-1.2.1/hbase-handler/src/java/org/apache/hadoop/hive/hbase/HBaseSerDe.java" target="_blank" rel="external">HBaseSerDe</a> and <a href="https://github.com/apache/hive/blob/release-1.2.1/hbase-handler/src/java/org/apache/hadoop/hive/hbase/HiveHBaseInputFormatUtil.java" target="_blank" rel="external">HiveHBaseInputFormatUtil</a>. According to these classes, 3 parameters are available to us:</p>
<ul>
<li>hbase.scan.cache: a value passed to Scan#setCaching method.</li>
<li>hbase.scan.cacheblock: a value passed to Scan#setCacheBlocks method.</li>
<li>hbase.scan.batch: a value passed to Scan#setBatch method.</li>
</ul>
<p>So basically, you would like to set first two parameters, and set the last parameter when the number of columns in HBase is large.</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2016/03/06/Passing-HBase-Configurations-from-Hive-Query/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-right" itemscope itemType="http://schema.org/BlogPosting">
        <div class="postShorten-wrap">
            <div class="postShorten-header">
                <h1 class="postShorten-title" itemprop="headline">
                    
                        <a class="link-unstyled" href="/2016/02/09/Before-Publishing-My-Dotfiles/">
                            Before Publishing My Dotfiles...
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time itemprop="datePublished" content="Tue Feb 09 2016 21:07:25 GMT-0800">
	
		    Feb 09, 2016
    	
    </time>
    
</div>
            </div>
            
            
                <div class="postShorten-excerpt" itemprop="articleBody">
                    <p>A lot of people have published their dotfiles,<br> and I have recently published <a href="https://github.com/smizoe/dotfiles" target="_blank" rel="external">my dotfiles</a> on my github repository.</p>
<p>Although I have been using git to manage my dotfiles, I did not make it public for a long time,<br>because several files in my dotfiles repository contain sensitive information<br>(for example, my proxy.pac contained FQDN of a proxy server to connect to servers in a datacenter.)</p>
<p>To bring my repository to a publishable state, I followed the following steps:</p>
<ol>
<li><p>after taking a backup of the sensitive files, remove them from the index of git.</p>
</li>
<li><p>encrypt the files (using ansible-vault.)</p>
</li>
<li><p>put them when running a provision script.</p>
</li>
</ol>
<p>In this post, I explain the steps above I took.</p>
                    
                        <a href="/2016/02/09/Before-Publishing-My-Dotfiles/" class="postShorten-excerpt_link link">
                            Continue reading
                        </a>
                        
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 Sho Mizoe. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Sho Mizoe</h4>
        
            <h5 id="about-card-bio"><p>Working on Hadoop and related technologies.<br>All code snippets are published under MIT License.</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Engineer at Insikt Inc.</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Santa Clara, CA
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/scrip-gfmrkxcl0qohe3cfdgxhzvc0yrceqta8i4iix0txvn8q4o2adlqd5n0jmkvt.min.js"></script>
<!--SCRIPTS END-->



</html>
